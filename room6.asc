#define HANDLE_TIMER 5
#define HANDLE_W_THREAD_TIMER 6

function loadClara()
{
  cEgo.x = 154;
  cEgo.y = 154;
  cEgo.FaceDirection(eDirectionUp);
  //cEgo.AddInventory(iGreenThread);
}

function loadCarlos()
{
  //cCarlos.ChangeRoom(player.Room, 85, 138);
  //cCarlos.LockView(CARLOSBATHROOM_1204);
}

function loadJoanna()
{
  //cJoanna.ChangeRoom(player.Room, 123, 131);
  //cJoanna.LockView(JOANNABATHROOM_1104);
  //cJoanna.Animate(0, 49, eRepeat, eNoBlock, eForwards);
}

function loadQueenie()
{
}

function loadObjects()
{
  oHandle.X = 87;
  oHandle.Y = 130;
  oHandle.Graphic = BATHROOM_HANDLE_SIDE;
  oHandle.Visible = true;
  
  oCord.X = 139;
  oCord.Y = 89;
  oCord.Graphic = BATHROOM_CORD;
  oCord.Visible = true;
  
  oSign.Graphic = BATHROOM_SIGN_OFF;
  oSign.Visible = true;
}

function room_Load()
{
  SetGameSpeed(80);
  
  loadClara();
  loadCarlos();
  loadJoanna();
  loadQueenie();
  
  loadObjects();
}

function room_AfterFadeIn()
{
  if (cCarlos.Room == player.Room)
  {
    cCarlos.Animate(1, 9, eOnce, eBlock, eForwards);
    cCarlos.Say("What are you doing in here, toots?");
    cEgo.Say("How ghastly!");
    cEgo.Walk(cEgo.x, cEgo.y + 100, eBlock, eAnywhere);
  }
  
  if (cJoanna.Room == player.Room)
  {
    Wait(100);
    cJoanna.StopMoving();
    cJoanna.Animate(1, 9, eOnce, eBlock, eForwards);
    cJoanna.Say("Please leave.");
    cEgo.Say("Okay.");
    cEgo.Walk(cEgo.x, cEgo.y + 100, eBlock, eAnywhere);
  }
}

function room_Unload()
{
  cCarlos.UnlockView();
}

function room_LeaveBottom()
{
  cEgo.ChangeRoom(3);
}

function room_RepExec()
{
  if (IsTimerExpired(HANDLE_TIMER))
  {
    oHandle.SetView(AIRPLANEBATHROOMDETAILS, 0, 2);
    oHandle.Animate(0, 4, eOnce, eBlock, eBackwards);
    oHandle.Graphic = BATHROOM_HANDLE_SIDE;
  }
  
  if (IsTimerExpired(HANDLE_W_THREAD_TIMER))
  {
    oHandle.SetView(CLARABATHROOMTHREADB_1008, 1, 1);
    oHandle.Animate(2, 4, eOnce, eBlock, eForwards);
    
    oHandle.X = 87;
    oHandle.Y = 130;
    oHandle.Graphic = BATHROOM_HANDLE_SIDE;
    oHandle.Visible = true;
    
    oCord.X = 139;
    oCord.Y = 89;
    oCord.Graphic = BATHROOM_CORD;
    oCord.Visible = true;
    
    oSign.Graphic = BATHROOM_SIGN_ON;
    Wait(100);
    cFlAttend.Say("Everything alright in there?");
    cEgo.Say("Everything is alright.");
    cFlAttend.Say("Okay. I will leave.");
    Wait(100);
    oSign.Graphic = BATHROOM_SIGN_OFF;
    cEgo.UnlockView();
    oCord.Visible = true;
  }
}

bool toggle = true;
function oCord_Interact(Object *theObject, CursorMode mode)
{
  if (toggle)
  {
    cEgo.Walk(149, 133, eBlock, eWalkableAreas);
    cEgo.FaceDirection(eDirectionLeft);
    cEgo.LockViewAligned(CLARABATHROOMTHREADA_1007, 0, eAlignRight);
    theObject.Visible = false;
    cEgo.Animate(0, 4, eOnce, eBlock, eForwards);
    
    Wait(10);
    
    theObject.Graphic = BATHROOM_CORD_W_THREAD;
    theObject.X -= 13;
    theObject.Y += 44;
    theObject.Visible = true;
    cEgo.UnlockView();
    cEgo.FaceDirection(eDirectionLeft);
    cEgo.Walk(113, 135, eBlock, eWalkableAreas);
    cEgo.FaceDirection(eDirectionUp);
    cEgo.LockViewAligned(CLARABATHROOMTHREADA_1007, 2, eAlignCenter);
    theObject.Graphic = BATHROOM_CORD;
    theObject.Visible = false;
    oHandle.Visible = false;
    cEgo.Animate(2, 4, eOnce, eBlock, eForwards);
    cEgo.Animate(3, 4, eOnce, eBlock, eForwards);
    cEgo.UnlockView();
    cEgo.FaceDirection(eDirectionUp);
    oHandle.X -= 11;
    oHandle.Y -= 4;
    oHandle.Graphic = BATHROOM_CORD_W_THREAD_HANDLE;
    oHandle.Visible = true;
    
    cEgo.Walk(cEgo.x - 15, cEgo.y - 4, eBlock, eWalkableAreas);
    cEgo.FaceDirection(eDirectionLeft);

    oHandle.Visible = false;
    cEgo.LockViewOffset(CLARABATHROOMTHREADB_1008, 15, -1);
    cEgo.Animate(0, 4, eOnce, eBlock, eForwards);
    cEgo.UnlockView();
    oHandle.Visible = true;
    SetTimer(HANDLE_W_THREAD_TIMER, 100);
    cEgo.FaceDirection(eDirectionLeft);
    
    toggle = false;
  }
  else
  {
    cEgo.Walk(149, 133, eBlock, eWalkableAreas);
    cEgo.FaceDirection(eDirectionLeft);
    cEgo.LockViewAligned(CLARABATHROOM_1006, 1, eAlignRight);
    theObject.Visible = false;
    cEgo.Animate(1, 4, eOnce, eBlock, eForwards);
    oSign.Graphic = BATHROOM_SIGN_ON;
    Wait(100);
    cFlAttend.Say("Everything alright in there?");
    cEgo.Say("Everything is alright.");
    cFlAttend.Say("Okay. I will leave.");
    Wait(100);
    oSign.Graphic = BATHROOM_SIGN_OFF;
    cEgo.UnlockView();
    theObject.Visible = true;
    
    toggle = true;
  }
}

function oHandle_Interact(Object *theObject, CursorMode mode)
{
  if (oHandle.Graphic == BATHROOM_HANDLE_UP)
  {
    Display("Not able to flush your poop at this time");
    return;
  }
  cEgo.Walk(98, 130, eBlock, eWalkableAreas);
  cEgo.FaceDirection(eDirectionLeft);
  theObject.Visible = false;
  cEgo.LockViewAligned(CLARABATHROOM_1006, 4, eAlignRight);
  cEgo.Animate(4, 6, eOnce, eBlock, eForwards);
  Display("Now flushing your poop");
  SetTimer(HANDLE_TIMER, 100);
  cEgo.UnlockView();
  cEgo.FaceDirection(eDirectionLeft);
  theObject.Graphic = BATHROOM_HANDLE_UP;
  theObject.Visible = true;
}

function oObject0_UseInv(Object *theObject, CursorMode mode)
{
  if (theObject.ID == iGreenThread.ID)
  {
    Display("put it on.");
  }
}
